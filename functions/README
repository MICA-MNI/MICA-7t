# Sorting and BIDS conforming 7T data

## Directory Contents

| **File**                    | **Description**                                                  |
|-----------------------------|------------------------------------------------------------------|
| `dcm2bids.py`               | Python script for converting DICOM data to BIDS format, with BIDS validation |
| `dcmSort.py`                | Python script to sort DICOM files (based on `pydicom`)           |
| `group_check.py`            | Python script for checking group characteristics or data integrity|
| `7t2bids`                   | Script to convert 7T MRI data to BIDS format, with BIDS validation           |
| `dcmSort`                   | Bash script to sort DICOM files (*legacy code*).                 |
| `denoiseN4`                 | Script for applying N4ITK denoising to MRI data                  |
| `post-qc_fastsurfer.sh`     | Shell script for post-processing quality control with FreeSurfer |
| `utilities.sh`              | Shell script with various utility functions for MRI processing   |

## Script usage

### Integrated workflow from DICOMS to BIDS
```bash
dcm2bids.py --sub SUB --ses SES --dicoms_dir DICOMS_DIR --sorted_dir SORTED_DIR --bids_dir BIDS_DIR
```


```bash
#!/bin/bash
# dcm2bids PNI 7t v2.1

sub=PNE018
ses=18

# Variables
data_dir="/data_/mica3/BIDS_PNI"
bids_dir="${data_dir}/rawdata"
dicoms_dir="${data_dir}/sorted/sub-${sub}_ses-${ses}/dicoms"
sorted_dir="${data_dir}/sorted/sub-${sub}_ses-${ses}/dicoms_sorted"

# Path to singularity image
dcm2bids_img=/data/mica1/01_programs/MICA-7t/dcm2bids_v2.1.sif

# Run dcm2bids.py with singularity container
singularity run --containall \
	-B "${bids_dir}":"${bids_dir}" \
	-B "${dicoms_dir}":"${dicoms_dir}" \
	-B "${sorted_dir}":"${sorted_dir}" \
    "${dcm2bids_img}" --sub "${sub}" --ses "${ses}" \
        --dicoms_dir "${dicoms_dir}" \
        --sorted_dir "${sorted_dir}" \
        --bids_dir "${bids_dir}"
```

### Modular workflow from DICOMS to BIDS
```bash
# Fisrt sort the dicoms
dcmSort DICOMS_DIR SORTED_DIR

# Then create the BIDS directory (SUB without sub-, SES without ses-)
7t2bids -in SORTED_DIR -id SUB -ses SES -bids BIDS_DIR 
```

### Denoising with N4 and NLM
```bash
denoiseN4 NIFTI OUT_NAME OUT_DIRECTORY N_THREADS
```

